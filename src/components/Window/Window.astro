---
import './Window.scss';
import StartMenu from '../StartMenu/StartMenu.astro';

export interface Props {
  title: string;
  iconSrc?: string;
  currentUrl?: string;
  menuItems?: Array<{
    label: string;
    onClick?: string;
    dropdown?: Array<{
      label: string;
      href: string;
    }>;
  }>;
  windowId?: string;
}

const { 
  title, 
  iconSrc = '/imgs/ie_extracted_assets/quad_icns_16x16.png',
  currentUrl = 'http://www.nateageek.com/',
  menuItems = [
    {
      label: 'File',
      dropdown: [
        { label: 'New', href: '#' },
        { label: 'Open...', href: '#' },
        { label: 'Save', href: '#' },
        { label: 'Save As...', href: '#' },
        { label: 'Page Setup...', href: '#' },
        { label: 'Print...', href: '#' },
        { label: 'Send', href: '#' },
        { label: 'Properties', href: '#' },
        { label: 'Close', href: '#' }
      ]
    },
    {
      label: 'Edit',
      dropdown: [
        { label: 'Cut', href: '#' },
        { label: 'Copy', href: '#' },
        { label: 'Paste', href: '#' },
        { label: 'Select All', href: '#' },
        { label: 'Find (on This Page)...', href: '#' }
      ]
    },
    {
      label: 'View',
      dropdown: [
        { label: 'Toolbars', href: '#' },
        { label: 'Status Bar', href: '#' },
        { label: 'Explorer Bar', href: '#' },
        { label: 'Go To', href: '#' },
        { label: 'Stop', href: '#' },
        { label: 'Refresh', href: '#' },
        { label: 'Text Size', href: '#' },
        { label: 'Encoding', href: '#' },
        { label: 'Source', href: '#' },
        { label: 'Full Screen', href: '#' }
      ]
    },
    { 
      label: 'Favorites', 
      dropdown: [
        { label: 'Add to Favorites...', href: '#' },
        { label: 'Organize Favorites...', href: '#' },
        { label: 'Links', href: '#' }
      ]
    },
    {
      label: 'Tools',
      dropdown: [
        { label: 'Mail and News', href: '#' },
        { label: 'Windows Update', href: '#' },
        { label: 'Synchronize...', href: '#' },
        { label: 'Internet Options...', href: '#' }
      ]
    },
    { 
      label: 'Help',
      dropdown: [
        { label: 'Contents and Index', href: '#' },
        { label: 'Tip of the Day', href: '#' },
        { label: 'For Netscape Users', href: '#' },
        { label: 'Online Support', href: '#' },
        { label: 'Send Feedback', href: '#' },
        { label: 'About Internet Explorer', href: '#' }
      ] 
    }
  ],
  windowId = 'mainWindow'
} = Astro.props;
---

<div class="container" id={windowId}>
  <div class="title-bar">
    <div class="title-text">
      <img src={iconSrc} alt="Icon" class="title-icon" width="16" height="16"/>
      {title}
    </div>
    <div class="window-controls">
      <div class="window-btn minimize" onclick={`minimizeWindow('${windowId}')`} title="Minimize">_</div>
      <div class="window-btn maximize" onclick={`maximizeWindow('${windowId}')`} title="Maximize Content">â–¡</div>
      <div class="window-btn close" onclick={`closeWindow('${windowId}')`} title="Close">Ã—</div>
    </div>
  </div>
  
  <div class="window-action-container">
  <div class="menu-bar">
    {menuItems.map((item, index) => (
      <div class="menu-item-container">
        {item.dropdown ? (
          <span 
            class="menu-item dropdown-trigger" 
            data-dropdown={`dropdown-${index}`}
            onclick={`toggleDropdown('dropdown-${index}')`}
          >
            {item.label}
          </span>
        ) : (
          <span class="menu-item" onclick={item.onClick}>{item.label}</span>
        )}
        
        {item.dropdown && (
          <div class="dropdown-menu" id={`dropdown-${index}`}>
            {item.dropdown.map(dropdownItem => (
              <a href={dropdownItem.href} class="dropdown-item">
                {dropdownItem.label}
              </a>
            ))}
          </div>
        )}
      </div>
    ))}
  </div>
  
  <!-- Browser Navigation Bar -->
  <div class="browser-nav">
    <div class="nav-buttons">
      <button class="ie-nav-btn back-btn" onclick="browserGoBack()" title="Back">
        <div class="ie-nav-icon ie-icon-back"></div>
      </button>
      <button class="ie-nav-btn forward-btn" onclick="browserGoForward()" title="Forward">
        <div class="ie-nav-icon ie-icon-forward"></div>
      </button>
      <button class="ie-nav-btn stop-btn" onclick="browserStop()" title="Stop">
        <div class="ie-nav-icon ie-icon-stop"></div>
      </button>
      <button class="ie-nav-btn reload-btn" onclick="browserReload()" title="Refresh">
        <div class="ie-nav-icon ie-icon-refresh"></div>
      </button>
      <button class="ie-nav-btn home-btn" onclick="browserGoHome()" title="Home">
        <div class="ie-nav-icon ie-icon-home"></div>
      </button>
      <div class="nav-separator"></div>
      <button class="ie-nav-btn search-btn" onclick="browserSearch()" title="Search">
        <div class="ie-nav-icon ie-icon-search"></div>
      </button>
      <button class="ie-nav-btn favorites-btn" onclick="alert('Guide - What is Cool on the Web!')" title="Favorites">
        <div class="ie-nav-icon ie-icon-favorites"></div>
      </button>
      <button class="ie-nav-btn print-btn" onclick="browserPrint()" title="Print">
        <div class="ie-nav-icon ie-icon-print"></div>
      </button>
      <button class="ie-nav-btn history-btn" onclick="alert('History')" title="History">
        <div class="ie-nav-icon ie-icon-history"></div>
      </button>
    </div>
    
    <div class="url-bar-container">
      <label class="url-label">Address</label>
      <div class="url-bar">
        <input 
          type="text" 
          class="url-input" 
          value={currentUrl}
          id="urlInput"
          onkeypress="handleUrlKeypress(event)"
          readonly
        />
        <button class="bookmark-btn" onclick="addBookmark()" title="Add to Bookmarks">
          <span>â˜…</span>
        </button>
      </div>
    </div>
  </div>
  </div>

  <div class="content-area">
    <div class="content-wrapper">
      <slot />
    </div>
  </div>
  
  <!-- Browser Status Bar -->
  <div class="status-bar">
    <div class="status-left">
      <span id="statusText">Done</span>
    </div>
    <div class="status-right">
      <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <span class="security-icon" title="Security: Normal - No Encryption">ðŸ”“</span>
      <span style="font-size: 10px; border: 1px inset #c0c0c0; padding: 1px 3px; background: #c0c0c0;">
        Internet
      </span>
    </div>
  </div>
</div>

<!-- Windows 95 Start Menu -->
<StartMenu />

<script>
  import './Window.ts';
</script>
